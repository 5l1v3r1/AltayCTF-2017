# BehindTheDoor
### Задание
Даны осциллограммы сигналов, которые необходимо раскодировать и получить флаг. На рисунке приведен фрагмент исходного сигнала. Также дано изображение-подсказка.

![Фрагмент сигнала](https://bitbucket.org/superBroDeLock/tasksaltayctf17/downloads/img5.jpg)

![Подсказка](https://bitbucket.org/superBroDeLock/tasksaltayctf17/downloads/img6.jpg)

### Решение
Подсказка сообщает о том, что сигналы получены от электронных ключей для домофона. Также указано название фирмы и название физического протокола.
В ключах-таблетках используется физический протокол 1-Wire, разработанный фирмой Dallas. Это не единственный протокол для этой цели, но самый распространённый.
Особенность данного протокола в том, что передача питания и данных происходит по одному проводу, так как контроллеры ключей не имеют собственного источника энергии.  Когда ключ подключается к домофону, он генерирует стартовый импульс (импульс присутствия).

![Ответ ключа на осциллограмме сигнала](https://bitbucket.org/superBroDeLock/tasksaltayctf17/downloads/img7.jpg)

Кодирование битов происходит с помощью различных длительностей импульсов низкого напряжения. При передаче единицы линия удерживается на низком напряжении в течении 15 мкс. При передаче нуля лини удерживается на низком напряжении в течении 60 мкс. На рисунке демонстрируется сравнение цифровых импульсов.

![Сравнение импульсов нуля и единицы](https://bitbucket.org/superBroDeLock/tasksaltayctf17/downloads/img8.jpg)

После выдачи ключом сигнала присутствия домофон запрашивает серийный номер ключа. Команда запроса серийного номера имеет код 11001100. Серийный номер имеет длину 8 байт и состоит из кода семейства устройства (равен 00000001 для обычных ключей), серийного номера (6 байт) и байта четности CRC. На рисунке приведена структура кода ответа от ключа.

![Структура кода ответа от ключа](https://bitbucket.org/superBroDeLock/tasksaltayctf17/downloads/img9.jpg)

Общая схема обмена данными:

![Общая схема обмена данными](https://bitbucket.org/superBroDeLock/tasksaltayctf17/downloads/img10.jpg)

![Демонстрация декодирования](https://bitbucket.org/superBroDeLock/tasksaltayctf17/downloads/img11.jpg)

Во время чтения четвертого ключа происходит сбой и сеанс обмена данных повторяется снова:

![Прерывание передачи данных](https://bitbucket.org/superBroDeLock/tasksaltayctf17/downloads/img12.jpg)

Для получения флага необходимо декодировать только 6-ти байтные серийные номера ключей. Объем закодированной в сигнале информации 24 байта, поэтому длина изображения сигнала позволяет произвести декодирование вручную. Совокупность цифровых кодов формирует ASCII-код флага:

![Полученная последовательность](https://bitbucket.org/superBroDeLock/tasksaltayctf17/downloads/img13.jpg)

Флаг:
```
Altay{to_open_all_doors}
```
