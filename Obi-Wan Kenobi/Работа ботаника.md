# Название
#### Работа ботаника
# Стоимость
#### 290
# Категория
#### Web
# Решение
Дан небольшой сервис с формой авторизации, поиска и обратной связи. Учитывая описание и механику работы, для хранения данных используются базы данных MySQL. Итого, намечаются такие варианты: либо пробиваться в авторизацию, либо пробиваться в поиск.
Авторизация, как выясняется, абсолютно бесполезна. Она сделана исключительно для отвлечения внимания, так же, как и форма обратной связи. Остается только поиск.
В самой форме стоит мощный WAF, который даже близко не дает подкрасться инъекциям. При любой попытке протолкнуть символы вроде ,.|\/'" выполнение скрипта завершается

![Ботан 1](https://github.com/SharLike-CTF-Team/AltayCTF-2017/blob/master/Obi-Wan%20Kenobi/Ботан1.PNG)

Казалось бы на этом можно отбросить идею пробиться в БД. Однако, есть еще один вектор - cookie. На сайте, помимо сессии, имеются следующие кукисы: cookie и num. num содержит числовое значение 0. А в cookie зашифрована какая-то информация. При чем эта информация меняется в зависимости от поискового запроса. Отсюда можно догадаться, что cookie и поиск как-то связаны. 
При некоторый запросах, вначале значения cookie появляется %3d:

![Ботан 1](https://github.com/SharLike-CTF-Team/AltayCTF-2017/blob/master/Obi-Wan%20Kenobi/Ботан2.PNG)

Если не узнали сразу - это знак '='. Смекаете?
А что, если это строка - зашифрованный base64 задом наперед? Попробуем развернуть и расшифровать.

![Ботан 1](https://github.com/SharLike-CTF-Team/AltayCTF-2017/blob/master/Obi-Wan%20Kenobi/Ботан3.PNG)

Да это же SQL запрос задом наперед! Получается, свой вопрос можно задать сюда, предварительно так же зашифровав. Осталось только понять, зачем нужен num.
Он всегда установлен в 0, и , если в этом положении попытаться сделать запрос, то он не выполнится. Исходя из логики, попробуем поставить его в 1, а в cookie сформировать зашифрованный запрос:
    ```
    1,2,TABLE_NAME from INFORMATION_SCHEMA.TABLES -- 
    ```
    В результате получим следующее отображение страницы:
    
![Ботан 1](https://github.com/SharLike-CTF-Team/AltayCTF-2017/blob/master/Obi-Wan%20Kenobi/Ботан4.PNG)

Успех! cookie не фильтруется, а значит сюда можно ввести любой запрос. А теперь смотрите, какая интересная таблица altay рядом с поисковой таблицей lessons. Выводим ее полностью снова шифрованным запросом:
```
    * from altay -- 
```
Смотрим результат:

![Ботан 1](https://github.com/SharLike-CTF-Team/AltayCTF-2017/blob/master/Obi-Wan%20Kenobi/Ботан5.PNG)

Бинго! Флаг получен, ботан наказан, и очередной таск отправляется в копилку ваших знаний.
### Флаг:
>Altay{filter_your_cookies_always}
